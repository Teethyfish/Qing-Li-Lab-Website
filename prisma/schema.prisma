// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")  // pooled
  directUrl = env("DIRECT_URL")    // direct for migrate/generate
}

enum Role {
  ADMIN
  PI
  MEMBER
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  role         Role     @default(MEMBER)
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  about        String?
  slug         String?   @unique
  imageUrl     String?
  locale       String   @default("en")
  mustResetPassword Boolean @default(false)
}

model AppConfig {
  key   String @id
  value String
}

model PendingInvite {
  id          String   @id @default(cuid())
  email       String   @unique
  name        String
  slug        String   @unique // desired public URL part, e.g. "lynn-zhang"
  note        String?          // optional message from the requester
  status      InviteStatus @default(PENDING)
  requestedAt DateTime  @default(now())
  decidedAt   DateTime?        // when approved/denied
  decidedById String?          // User.id of the approver (ADMIN or PI)
}

enum InviteStatus {
  PENDING
  APPROVED
  DENIED
}

model Announcement {
  id           String   @id @default(cuid())
  imageUrl     String   // URL to the banner image
  text         String   // JSON object storing translations {en: string, zh?: string, ko?: string}
  croppedArea  String?  // JSON string storing crop coordinates {x, y, width, height}
  order        Int      @default(0) // Display order (lower numbers first)
  isActive     Boolean  @default(true) // Whether to show this announcement
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

